<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Booking System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .seat {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .seat.available {
            background-color: #d1fae5;
            border: 2px solid #99f6e4;
        }
        .seat.available:hover {
            background-color: #a7f3d0;
        }
        .seat.selected {
            background-color: #3b82f6;
            color: white;
            border: 2px solid #2563eb;
        }
        .seat.booked {
            background-color: #ef4444;
            color: white;
            border: 2px solid #dc2626;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        class BusBookingApp {
            constructor() {
                this.state = {
                    currentUser: null,
                    users: [
                        { id: 1, username: 'admin', password: 'admin123', role: 'admin', name: 'Admin User' },
                        { id: 2, username: 'user1', password: 'pass123', role: 'user', name: 'John Doe' }
                    ],
                    buses: [
                        {
                            id: 1,
                            name: 'Express 101',
                            route: 'Chennai - Bangalore',
                            totalSeats: 40,
                            pricePerSeat: 500,
                            departureTime: '08:00',
                            arrivalTime: '14:00',
                            date: '2025-08-26',
                            expenses: [
                                { id: 1, type: 'Fuel', amount: 5000, description: 'Diesel for route' },
                                { id: 2, type: 'Driver', amount: 2000, description: 'Driver salary' },
                                { id: 3, type: 'Maintenance', amount: 1500, description: 'Bus maintenance' }
                            ]
                        },
                        {
                            id: 2,
                            name: 'Deluxe 202',
                            route: 'Chennai - Coimbatore',
                            totalSeats: 35,
                            pricePerSeat: 600,
                            departureTime: '10:30',
                            arrivalTime: '17:00',
                            date: '2025-08-26',
                            expenses: [
                                { id: 1, type: 'Fuel', amount: 4500, description: 'Diesel for route' },
                                { id: 2, type: 'Driver', amount: 2200, description: 'Driver salary' }
                            ]
                        }
                    ],
                    bookings: [],
                    activeTab: 'booking',
                    showLogin: true,
                    loginData: { username: '', password: '' },
                    signupData: { username: '', password: '', name: '' },
                    showPassword: false,
                    selectedBus: null,
                    selectedSeats: []
                };
                this.generateSeatsForBuses();
                this.render();
                this.startRealTimeUpdates();
            }

            generateSeats(totalSeats) {
                const seats = [];
                for (let i = 1; i <= totalSeats; i++) {
                    seats.push({
                        id: i,
                        number: `${String.fromCharCode(65 + Math.floor((i - 1) / 4))}${((i - 1) % 4) + 1}`,
                        isBooked: false,
                        bookedBy: null
                    });
                }
                return seats;
            }

            generateSeatsForBuses() {
                this.state.buses = this.state.buses.map(bus => ({
                    ...bus,
                    seats: bus.seats || this.generateSeats(bus.totalSeats)
                }));
            }

            startRealTimeUpdates() {
                setInterval(() => {
                    this.updateSeatStatus();
                    if (this.state.selectedBus) {
                        this.updateSelectedBus();
                    }
                }, 1000);
            }

            updateSeatStatus() {
                this.state.buses = this.state.buses.map(bus => ({
                    ...bus,
                    seats: bus.seats.map(seat => ({
                        ...seat,
                        isBooked: this.state.bookings.some(booking => 
                            booking.busId === bus.id && booking.seatNumbers.includes(seat.number)
                        ),
                        bookedBy: this.state.bookings.find(booking => 
                            booking.busId === bus.id && booking.seatNumbers.includes(seat.number)
                        )?.userId
                    }))
                }));
            }

            updateSelectedBus() {
                const bus = this.state.buses.find(b => b.id === this.state.selectedBus.id);
                if (bus) {
                    this.state.selectedBus = bus;
                }
            }

            setState(partialState) {
                this.state = { ...this.state, ...partialState };
                this.render();
            }

            handleLogin(e) {
                e.preventDefault();
                const user = this.state.users.find(u => 
                    u.username === this.state.loginData.username && 
                    u.password === this.state.loginData.password
                );
                if (user) {
                    this.setState({ 
                        currentUser: user, 
                        showLogin: false, 
                        activeTab: 'booking' 
                    });
                } else {
                    alert('Invalid credentials!');
                }
            }

            handleSignup(e) {
                e.preventDefault();
                if (this.state.users.some(u => u.username === this.state.signupData.username)) {
                    alert('Username already exists!');
                    return;
                }
                const newUser = {
                    id: this.state.users.length + 1,
                    ...this.state.signupData,
                    role: 'user'
                };
                this.setState({
                    users: [...this.state.users, newUser]
                });
                alert('Account created successfully! Please login.');
                this.setState({ signupData: { username: '', password: '', name: '' } });
            }

            handleSeatSelection(seat) {
                if (seat.isBooked) return;
                
                const selectedSeats = this.state.selectedSeats.includes(seat.number) 
                    ? this.state.selectedSeats.filter(s => s !== seat.number)
                    : [...this.state.selectedSeats, seat.number];
                
                this.setState({ selectedSeats });
            }

            handleBooking() {
                if (this.state.selectedSeats.length === 0) {
                    alert('Please select at least one seat!');
                    return;
                }

                const newBooking = {
                    id: this.state.bookings.length + 1,
                    userId: this.state.currentUser.id,
                    busId: this.state.selectedBus.id,
                    seatNumbers: this.state.selectedSeats,
                    totalAmount: this.state.selectedSeats.length * this.state.selectedBus.pricePerSeat,
                    bookingDate: new Date().toISOString(),
                    passengerName: this.state.currentUser.name
                };

                this.setState({
                    bookings: [...this.state.bookings, newBooking],
                    selectedSeats: []
                });
                alert(`Booking confirmed! Total: ₹${newBooking.totalAmount}`);
            }

            calculateBusRevenue(bus) {
                const busBookings = this.state.bookings.filter(booking => booking.busId === bus.id);
                return busBookings.reduce((total, booking) => total + booking.totalAmount, 0);
            }

            calculateBusExpenses(bus) {
                return (bus.expenses || []).reduce((total, expense) => total + expense.amount, 0);
            }

            calculateBusProfit(bus) {
                return this.calculateBusRevenue(bus) - this.calculateBusExpenses(bus);
            }

            getSeatClass(seat) {
                if (seat.isBooked) return 'seat booked';
                if (this.state.selectedSeats.includes(seat.number)) return 'seat selected';
                return 'seat available';
            }

            renderLogin() {
                return `
                <div class="min-h-screen bg-gradient-to-br from-blue-900 to-purple-900 flex items-center justify-center p-4">
                    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
                        <div class="text-center mb-8">
                            <svg class="w-16 h-16 mx-auto text-blue-600 mb-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><circle cx="12" cy="14" r="2"></circle><path d="M2 7h20"></path><path d="M16 3v4"></path><path d="M8 3v4"></path></svg>
                            <h1 class="text-3xl font-bold text-gray-800">Bus Booking System</h1>
                        </div>

                        <div class="space-y-4 mb-6">
                            <button class="w-full py-2 px-4 rounded-lg transition-all ${this.state.activeTab === 'login' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}" onclick="app.setState({activeTab: 'login'})">
                                Login
                            </button>
                            <button class="w-full py-2 px-4 rounded-lg transition-all ${this.state.activeTab === 'signup' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}" onclick="app.setState({activeTab: 'signup'})">
                                Sign Up
                            </button>
                        </div>

                        ${this.state.activeTab === 'login' ? this.renderLoginForm() : this.renderSignupForm()}
                    </div>
                </div>
                `;
            }

            renderLoginForm() {
                return `
                <form onsubmit="app.handleLogin(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input
                            type="text"
                            value="${this.state.loginData.username}"
                            oninput="app.setState({loginData: {...app.state.loginData, username: this.value}})"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <div class="relative">
                            <input
                                type="${this.state.showPassword ? 'text' : 'password'}"
                                value="${this.state.loginData.password}"
                                oninput="app.setState({loginData: {...app.state.loginData, password: this.value}})"
                                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-10"
                                required
                            />
                            <button
                                type="button"
                                onclick="app.setState({showPassword: !app.state.showPassword})"
                                class="absolute right-3 top-3 text-gray-400"
                            >
                                <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                            </button>
                        </div>
                    </div>
                    <button
                        type="submit"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors"
                    >
                        Login
                    </button>
                    <div class="text-sm text-gray-600 text-center">
                        Demo: admin/admin123 or user1/pass123
                    </div>
                </form>
                `;
            }

            renderSignupForm() {
                return `
                <form onsubmit="app.handleSignup(event)" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name</label>
                        <input
                            type="text"
                            value="${this.state.signupData.name}"
                            oninput="app.setState({signupData: {...app.state.signupData, name: this.value}})"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input
                            type="text"
                            value="${this.state.signupData.username}"
                            oninput="app.setState({signupData: {...app.state.signupData, username: this.value}})"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input
                            type="password"
                            value="${this.state.signupData.password}"
                            oninput="app.setState({signupData: {...app.state.signupData, password: this.value}})"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required
                        />
                    </div>
                    <button
                        type="submit"
                        class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors"
                    >
                        Create Account
                    </button>
                </form>
                `;
            }

            renderHeader() {
                return `
                <header class="bg-white shadow-lg">
                    <div class="max-w-7xl mx-auto px-4 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <svg class="w-8 h-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><circle cx="12" cy="14" r="2"></circle><path d="M2 7h20"></path><path d="M16 3v4"></path><path d="M8 3v4"></path></svg>
                                <h1 class="text-2xl font-bold text-gray-800">Bus Booking System</h1>
                            </div>
                            <div class="flex items-center space-x-4">
                                <span class="text-gray-600">Welcome, ${this.state.currentUser.name}</span>
                                <span class="px-3 py-1 rounded-full text-sm ${this.state.currentUser.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">
                                    ${this.state.currentUser.role.toUpperCase()}
                                </span>
                                <button onclick="app.setState({currentUser: null, showLogin: true});" class="flex items-center space-x-2 text-gray-600 hover:text-red-600">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                                    <span>Logout</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </header>
                `;
            }

            renderNavigation() {
                return `
                <nav class="bg-blue-600 text-white">
                    <div class="max-w-7xl mx-auto px-4">
                        <div class="flex space-x-8">
                            <button onclick="app.setState({activeTab: 'booking'})" class="py-4 px-2 border-b-2 transition-colors ${this.state.activeTab === 'booking' ? 'border-white' : 'border-transparent hover:border-blue-200'}">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><circle cx="12" cy="14" r="2"></circle><path d="M2 7h20"></path><path d="M16 3v4"></path><path d="M8 3v4"></path></svg>
                                    <span>Book Seats</span>
                                </div>
                            </button>
                            ${this.state.currentUser.role === 'admin' ? `
                            <button onclick="app.setState({activeTab: 'revenue'})" class="py-4 px-2 border-b-2 transition-colors ${this.state.activeTab === 'revenue' ? 'border-white' : 'border-transparent hover:border-blue-200'}">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" x2="12" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>
                                    <span>Revenue & Expenses</span>
                                </div>
                            </button>
                            <button onclick="app.setState({activeTab: 'users'})" class="py-4 px-2 border-b-2 transition-colors ${this.state.activeTab === 'users' ? 'border-white' : 'border-transparent hover:border-blue-200'}">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                                    <span>All Users</span>
                                </div>
                            </button>
                            <button onclick="app.setState({activeTab: 'bookings'})" class="py-4 px-2 border-b-2 transition-colors ${this.state.activeTab === 'bookings' ? 'border-white' : 'border-transparent hover:border-blue-200'}">
                                <div class="flex items-center space-x-2">
                                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2" ry="2"></rect><line x1="2" y1="10" x2="22" y2="10"></line></svg>
                                    <span>All Bookings</span>
                                </div>
                            </button>
                            ` : ''}
                        </div>
                    </div>
                </nav>
                `;
            }

            renderBookingTab() {
                return `
                <div class="space-y-8">
                    <h2 class="text-3xl font-bold text-gray-800">Available Buses</h2>
                    
                    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                        ${this.state.buses.map(bus => `
                        <div key="${bus.id}" class="bg-white rounded-lg shadow-lg overflow-hidden">
                            <div class="p-6">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-xl font-bold text-gray-800">${bus.name}</h3>
                                    <span class="text-2xl font-bold text-blue-600">₹${bus.pricePerSeat}</span>
                                </div>
                                <div class="space-y-2 text-gray-600">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path><circle cx="12" cy="10" r="3"></circle></svg>
                                        <span>${bus.route}</span>
                                    </div>
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
                                        <span>${bus.date} | ${bus.departureTime} - ${bus.arrivalTime}</span>
                                    </div>
                                    <div>
                                        <span>Available: ${bus.seats.filter(seat => !seat.isBooked).length}/${bus.totalSeats} seats</span>
                                    </div>
                                </div>
                                <button onclick="app.setState({selectedBus: app.state.buses.find(b => b.id === ${bus.id})})" class="w-full mt-4 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                    Select Seats
                                </button>
                            </div>
                        </div>
                        `).join('')}
                    </div>

                    ${this.state.selectedBus ? this.renderSeatSelection() : ''}
                </div>
                `;
            }

            renderSeatSelection() {
                return `
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">Select Seats - ${this.state.selectedBus.name}</h3>
                        <button onclick="app.setState({selectedBus: null, selectedSeats: []})" class="text-gray-500 hover:text-gray-700">
                            ✕
                        </button>
                    </div>

                    <div class="mb-6">
                        <div class="flex items-center space-x-6 text-sm">
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-green-200 rounded"></div>
                                <span>Available</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-blue-500 rounded"></div>
                                <span>Selected</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 bg-red-500 rounded"></div>
                                <span>Booked</span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-6">
                        <div class="bg-gray-800 text-white text-center py-2 rounded-t-lg mb-4">
                            Driver
                        </div>
                        <div class="grid grid-cols-4 gap-2 max-w-md mx-auto">
                            ${this.state.selectedBus.seats.map(seat => `
                            <div
                                key="${seat.id}"
                                onclick="app.handleSeatSelection(${JSON.stringify(seat)})"
                                class="${this.getSeatClass(seat)}"
                            >
                                ${seat.number}
                            </div>
                            `).join('')}
                        </div>
                    </div>

                    ${this.state.selectedSeats.length > 0 ? `
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <p class="font-semibold">Selected Seats: ${this.state.selectedSeats.join(', ')}</p>
                                <p class="text-lg font-bold text-blue-600">
                                    Total: ₹${this.state.selectedSeats.length * this.state.selectedBus.pricePerSeat}
                                </p>
                            </div>
                            <button onclick="app.handleBooking()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition-colors">
                                Confirm Booking
                            </button>
                        </div>
                    </div>
                    ` : ''}
                </div>
                `;
            }

            renderRevenueTab() {
                return `
                <div class="space-y-8">
                    <h2 class="text-3xl font-bold text-gray-800">Revenue & Expense Management</h2>
                    
                    ${this.state.buses.map(bus => {
                        const revenue = this.calculateBusRevenue(bus);
                        const expenses = this.calculateBusExpenses(bus);
                        const profit = revenue - expenses;
                        return `
                        <div key="${bus.id}" class="bg-white rounded-lg shadow-lg p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-6">${bus.name} - ${bus.route}</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div class="bg-green-100 p-4 rounded-lg text-center">
                                    <h4 class="text-lg font-semibold text-green-800">Revenue</h4>
                                    <p class="text-2xl font-bold text-green-600">₹${revenue}</p>
                                    <p class="text-sm text-gray-600">
                                        ${this.state.bookings.filter(b => b.busId === bus.id).length} bookings
                                    </p>
                                </div>
                                <div class="bg-red-100 p-4 rounded-lg text-center">
                                    <h4 class="text-lg font-semibold text-red-800">Expenses</h4>
                                    <p class="text-2xl font-bold text-red-600">₹${expenses}</p>
                                    <p class="text-sm text-gray-600">
                                        ${bus.expenses?.length || 0} expense items
                                    </p>
                                </div>
                                <div class="bg-blue-100 p-4 rounded-lg text-center">
                                    <h4 class="text-lg font-semibold text-blue-800">Profit</h4>
                                    <p class="text-2xl font-bold ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                                        ₹${profit}
                                    </p>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="text-lg font-semibold mb-4">Seat Collection Details</h4>
                                    <div class="space-y-2">
                                        ${this.state.bookings.filter(booking => booking.busId === bus.id).map(booking => `
                                        <div key="${booking.id}" class="flex justify-between items-center bg-gray-50 p-3 rounded">
                                            <div>
                                                <p class="font-medium">${booking.passengerName}</p>
                                                <p class="text-sm text-gray-600">Seats: ${booking.seatNumbers.join(', ')}</p>
                                            </div>
                                            <p class="font-bold text-green-600">₹${booking.totalAmount}</p>
                                        </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div>
                                    <h4 class="text-lg font-semibold mb-4">Expense Breakdown</h4>
                                    <div class="space-y-2">
                                        ${(bus.expenses || []).map(expense => `
                                        <div key="${expense.id}" class="flex justify-between items-center bg-gray-50 p-3 rounded">
                                            <div>
                                                <p class="font-medium">${expense.type}</p>
                                                <p class="text-sm text-gray-600">${expense.description}</p>
                                            </div>
                                            <p class="font-bold text-red-600">₹${expense.amount}</p>
                                        </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
                `;
            }

            renderUsersTab() {
                return `
                <div class="space-y-8">
                    <h2 class="text-3xl font-bold text-gray-800">All Users</h2>
                    
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Username</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bookings</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Spent</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${this.state.users.map(user => {
                                    const userBookings = this.state.bookings.filter(booking => booking.userId === user.id);
                                    const totalSpent = userBookings.reduce((total, booking) => total + booking.totalAmount, 0);
                                    return `
                                    <tr key="${user.id}">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900">${user.name}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-500">${user.username}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 py-1 text-xs font-semibold rounded-full ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">
                                                ${user.role.toUpperCase()}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${userBookings.length}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">
                                            ₹${totalSpent}
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                `;
            }

            renderBookingsTab() {
                return `
                <div class="space-y-8">
                    <h2 class="text-3xl font-bold text-gray-800">All Bookings</h2>
                    
                    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Booking ID</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Passenger</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bus</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Seats</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                                ${this.state.bookings.map(booking => {
                                    const bus = this.state.buses.find(b => b.id === booking.busId);
                                    const user = this.state.users.find(u => u.id === booking.userId);
                                    return `
                                    <tr key="${booking.id}">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                            #${booking.id}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${user?.name || 'Unknown'}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900">${bus?.name}</div>
                                            <div class="text-sm text-gray-500">${bus?.route}</div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                            ${booking.seatNumbers.join(', ')}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-green-600">
                                            ₹${booking.totalAmount}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                            ${new Date(booking.bookingDate).toLocaleDateString()}
                                        </td>
                                    </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                `;
            }

            renderMainContent() {
                if (this.state.activeTab === 'booking') {
                    return this.renderBookingTab();
                } else if (this.state.activeTab === 'revenue' && this.state.currentUser.role === 'admin') {
                    return this.renderRevenueTab();
                } else if (this.state.activeTab === 'users' && this.state.currentUser.role === 'admin') {
                    return this.renderUsersTab();
                } else if (this.state.activeTab === 'bookings' && this.state.currentUser.role === 'admin') {
                    return this.renderBookingsTab();
                }
                return '';
            }

            render() {
                const app = document.getElementById('app');
                app.innerHTML = this.state.showLogin 
                    ? this.renderLogin() 
                    : `
                <div class="min-h-screen bg-gray-100">
                    ${this.renderHeader()}
                    ${this.renderNavigation()}
                    <main class="max-w-7xl mx-auto px-4 py-8">
                        ${this.renderMainContent()}
                    </main>
                </div>
                `;
            }
        }

        // Initialize the app when the page loads
        let app;
        document.addEventListener('DOMContentLoaded', () => {
            app = new BusBookingApp();
        });
    </script>
</body>
</html>
```
